name: Gold Drawings Processing Using Nautilus Librarian

on:
  pull_request:
    branches: [ main, issue-* ]
  workflow_dispatch:

jobs:
  process-gold-images:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0 # To fetch all history for all branches and tags. Needed for git diff.
          submodules: 'true'

      - name: Setup Python
        uses: actions/setup-python@v2.3.1
        with:
          python-version: '3.9'

      - name: Install Librarian dependencies
        run: |
          sudo apt-get update
          sudo apt-get upgrade -y
          sudo apt-get install -y libvips-dev 

      - name: Install Librarian using Python package (documented way)
        run: pip install nautilus-librarian

      - name: Set GPG key user as the Git global user
        run: |
          git config --global user.email "yeray.rodriguez@edataconsulting.de"
          git config --global user.name "Yeray Rodriguez"

      - name: Run librarian gold image processing command
        run: |
          nautilus-librarian gold-images-processing
